/*! bespeak-angular 02-01-2014 */
angular.module("ui.bootstrap",["ui.bootstrap.tpls","ui.bootstrap.alert","ui.bootstrap.buttons","ui.bootstrap.transition","ui.bootstrap.progressbar","ui.bootstrap.timepicker"]),angular.module("ui.bootstrap.tpls",["template/alert/alert.html","template/progressbar/bar.html","template/progressbar/progress.html","template/timepicker/timepicker.html"]),angular.module("ui.bootstrap.alert",[]).directive("alert",function(){return{restrict:"EA",templateUrl:"template/alert/alert.html",transclude:!0,replace:!0,scope:{type:"=",close:"&"},link:function(a,b,c){a.closeable="close"in c}}}),angular.module("ui.bootstrap.buttons",[]).constant("buttonConfig",{activeClass:"active",toggleEvent:"click"}).directive("btnRadio",["buttonConfig",function(a){var b=a.activeClass||"active",c=a.toggleEvent||"click";return{require:"ngModel",link:function(a,d,e,f){f.$render=function(){d.toggleClass(b,angular.equals(f.$modelValue,a.$eval(e.btnRadio)))},d.bind(c,function(){d.hasClass(b)||a.$apply(function(){f.$setViewValue(a.$eval(e.btnRadio)),f.$render()})})}}}]).directive("btnCheckbox",["buttonConfig",function(a){var b=a.activeClass||"active",c=a.toggleEvent||"click";return{require:"ngModel",link:function(a,d,e,f){var g=a.$eval(e.btnCheckboxTrue),h=a.$eval(e.btnCheckboxFalse);g=angular.isDefined(g)?g:!0,h=angular.isDefined(h)?h:!1,f.$render=function(){d.toggleClass(b,angular.equals(f.$modelValue,g))},d.bind(c,function(){a.$apply(function(){f.$setViewValue(d.hasClass(b)?h:g),f.$render()})})}}}]),angular.module("ui.bootstrap.transition",[]).factory("$transition",["$q","$timeout","$rootScope",function(a,b,c){function d(a){for(var b in a)if(void 0!==f.style[b])return a[b]}var e=function(d,f,g){g=g||{};var h=a.defer(),i=e[g.animation?"animationEndEventName":"transitionEndEventName"],j=function(){c.$apply(function(){d.unbind(i,j),h.resolve(d)})};return i&&d.bind(i,j),b(function(){angular.isString(f)?d.addClass(f):angular.isFunction(f)?f(d):angular.isObject(f)&&d.css(f),i||h.resolve(d)}),h.promise.cancel=function(){i&&d.unbind(i,j),h.reject("Transition cancelled")},h.promise},f=document.createElement("trans"),g={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",transition:"transitionend"},h={WebkitTransition:"webkitAnimationEnd",MozTransition:"animationend",OTransition:"oAnimationEnd",transition:"animationend"};return e.transitionEndEventName=d(g),e.animationEndEventName=d(h),e}]),angular.module("ui.bootstrap.progressbar",["ui.bootstrap.transition"]).constant("progressConfig",{animate:!0,autoType:!1,stackedTypes:["success","info","warning","danger"]}).controller("ProgressBarController",["$scope","$attrs","progressConfig",function(a,b,c){function d(a){return g[a]}var e=angular.isDefined(b.animate)?a.$eval(b.animate):c.animate,f=angular.isDefined(b.autoType)?a.$eval(b.autoType):c.autoType,g=angular.isDefined(b.stackedTypes)?a.$eval("["+b.stackedTypes+"]"):c.stackedTypes;this.makeBar=function(a,b,c){var g=angular.isObject(a)?a.value:a||0,h=angular.isObject(b)?b.value:b||0,i=angular.isObject(a)&&angular.isDefined(a.type)?a.type:f?d(c||0):null;return{from:h,to:g,type:i,animate:e}},this.addBar=function(b){a.bars.push(b),a.totalPercent+=b.to},this.clearBars=function(){a.bars=[],a.totalPercent=0},this.clearBars()}]).directive("progress",function(){return{restrict:"EA",replace:!0,controller:"ProgressBarController",scope:{value:"=percent",onFull:"&",onEmpty:"&"},templateUrl:"template/progressbar/progress.html",link:function(a,b,c,d){a.$watch("value",function(a,b){if(d.clearBars(),angular.isArray(a))for(var c=0,e=a.length;e>c;c++)d.addBar(d.makeBar(a[c],b[c],c));else d.addBar(d.makeBar(a,b))},!0),a.$watch("totalPercent",function(b){b>=100?a.onFull():0>=b&&a.onEmpty()},!0)}}}).directive("progressbar",["$transition",function(a){return{restrict:"EA",replace:!0,scope:{width:"=",old:"=",type:"=",animate:"="},templateUrl:"template/progressbar/bar.html",link:function(b,c){b.$watch("width",function(d){b.animate?(c.css("width",b.old+"%"),a(c,{width:d+"%"})):c.css("width",d+"%")})}}}]),angular.module("ui.bootstrap.timepicker",[]).filter("pad",function(){return function(a){return angular.isDefined(a)&&a.toString().length<2&&(a="0"+a),a}}).constant("timepickerConfig",{hourStep:1,minuteStep:1,showMeridian:!0,meridians:["AM","PM"],readonlyInput:!1,mousewheel:!0}).directive("timepicker",["padFilter","$parse","timepickerConfig",function(a,b,c){return{restrict:"EA",require:"ngModel",replace:!0,templateUrl:"template/timepicker/timepicker.html",scope:{model:"=ngModel"},link:function(d,e,f){function g(){var a=parseInt(d.hours,10),b=d.showMeridian?a>0&&13>a:a>=0&&24>a;return b?(d.showMeridian&&(12===a&&(a=0),d.meridian===k[1]&&(a+=12)),a):void 0}function h(){var b=j.getHours();d.showMeridian&&(b=0===b||12===b?12:b%12),d.hours="h"===s?b:a(b),d.validHours=!0;var c=j.getMinutes();d.minutes="m"===s?c:a(c),d.validMinutes=!0,d.meridian=d.showMeridian?j.getHours()<12?k[0]:k[1]:"",s=!1}function i(a){var b=new Date(j.getTime()+6e4*a);b.getDate()!==j.getDate()&&b.setDate(b.getDate()-1),j.setTime(b.getTime()),d.model=new Date(j)}var j=new Date,k=c.meridians,l=c.hourStep;f.hourStep&&d.$parent.$watch(b(f.hourStep),function(a){l=parseInt(a,10)});var m=c.minuteStep;f.minuteStep&&d.$parent.$watch(b(f.minuteStep),function(a){m=parseInt(a,10)}),d.showMeridian=c.showMeridian,f.showMeridian&&d.$parent.$watch(b(f.showMeridian),function(a){if(d.showMeridian=!!a,d.model)h();else{var b=new Date(j),c=g();angular.isDefined(c)&&b.setHours(c),d.model=new Date(b)}});var n=e.find("input"),o=n.eq(0),p=n.eq(1),q=angular.isDefined(f.mousewheel)?d.$eval(f.mousewheel):c.mousewheel;if(q){var r=function(a){return a.originalEvent&&(a=a.originalEvent),a.detail||a.wheelDelta>0};o.bind("mousewheel",function(a){d.$apply(r(a)?d.incrementHours():d.decrementHours()),a.preventDefault()}),p.bind("mousewheel",function(a){d.$apply(r(a)?d.incrementMinutes():d.decrementMinutes()),a.preventDefault()})}var s=!1;d.readonlyInput=angular.isDefined(f.readonlyInput)?d.$eval(f.readonlyInput):c.readonlyInput,d.readonlyInput?(d.updateHours=angular.noop,d.updateMinutes=angular.noop):(d.updateHours=function(){var a=g();angular.isDefined(a)?(s="h",null===d.model&&(d.model=new Date(j)),d.model.setHours(a)):(d.model=null,d.validHours=!1)},o.bind("blur",function(){d.validHours&&d.hours<10&&d.$apply(function(){d.hours=a(d.hours)})}),d.updateMinutes=function(){var a=parseInt(d.minutes,10);a>=0&&60>a?(s="m",null===d.model&&(d.model=new Date(j)),d.model.setMinutes(a)):(d.model=null,d.validMinutes=!1)},p.bind("blur",function(){d.validMinutes&&d.minutes<10&&d.$apply(function(){d.minutes=a(d.minutes)})})),d.$watch(function(){return+d.model},function(a){!isNaN(a)&&a>0&&(j=new Date(a),h())}),d.incrementHours=function(){i(60*l)},d.decrementHours=function(){i(60*-l)},d.incrementMinutes=function(){i(m)},d.decrementMinutes=function(){i(-m)},d.toggleMeridian=function(){i(720*(j.getHours()<12?1:-1))}}}}]),angular.module("template/alert/alert.html",[]).run(["$templateCache",function(a){a.put("template/alert/alert.html","<div class='alert' ng-class='type && \"alert-\" + type'>\n    <button ng-show='closeable' type='button' class='close' ng-click='close()'>&times;</button>\n    <div ng-transclude></div>\n</div>\n")}]),angular.module("template/progressbar/bar.html",[]).run(["$templateCache",function(a){a.put("template/progressbar/bar.html",'<div class="bar" ng-class=\'type && "bar-" + type\'></div>')}]),angular.module("template/progressbar/progress.html",[]).run(["$templateCache",function(a){a.put("template/progressbar/progress.html",'<div class="progress"><progressbar ng-repeat="bar in bars" width="bar.to" old="bar.from" animate="bar.animate" type="bar.type"></progressbar></div>')}]),angular.module("template/timepicker/timepicker.html",[]).run(["$templateCache",function(a){a.put("template/timepicker/timepicker.html",'<table class="form-inline">\n	<tr class="text-center">\n		<td><a ng-click="incrementHours()" class="btn btn-link"><i class="icon-chevron-up"></i></a></td>\n		<td>&nbsp;</td>\n		<td><a ng-click="incrementMinutes()" class="btn btn-link"><i class="icon-chevron-up"></i></a></td>\n		<td ng-show="showMeridian"></td>\n	</tr>\n	<tr>\n		<td class="control-group" ng-class="{\'error\': !validHours}"><input type="text" ng-model="hours" ng-change="updateHours()" class="span1 text-center" ng-mousewheel="incrementHours()" ng-readonly="readonlyInput" maxlength="2" /></td>\n		<td>:</td>\n		<td class="control-group" ng-class="{\'error\': !validMinutes}"><input type="text" ng-model="minutes" ng-change="updateMinutes()" class="span1 text-center" ng-readonly="readonlyInput" maxlength="2"></td>\n		<td ng-show="showMeridian"><button ng-click="toggleMeridian()" class="btn text-center">{{meridian}}</button></td>\n	</tr>\n	<tr class="text-center">\n		<td><a ng-click="decrementHours()" class="btn btn-link"><i class="icon-chevron-down"></i></a></td>\n		<td>&nbsp;</td>\n		<td><a ng-click="decrementMinutes()" class="btn btn-link"><i class="icon-chevron-down"></i></a></td>\n		<td ng-show="showMeridian"></td>\n	</tr>\n</table>')}]),angular.module("angularPayments",[]),angular.module("angularPayments").factory("Common",[function(){var a={};return a.parseExpiry=function(a){var b,c,d,e;return a=a||"",a=a.replace(/\s/g,""),e=a.split("/",2),b=e[0],d=e[1],2===(null!=d?d.length:void 0)&&/^\d+$/.test(d)&&(c=(new Date).getFullYear(),c=c.toString().slice(0,2),d=c+d),b=parseInt(b,10),d=parseInt(d,10),{month:b,year:d}},a}]),angular.module("angularPayments").factory("Cards",[function(){var a=/(\d{1,4})/g,b=/(?:^|\s)(\d{4})$/,c=[{type:"maestro",pattern:/^(5018|5020|5038|6304|6759|676[1-3])/,format:a,inputFormat:b,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"dinersclub",pattern:/^(36|38|30[0-5])/,format:a,inputFormat:b,length:[14],cvcLength:[3],luhn:!0},{type:"laser",pattern:/^(6706|6771|6709)/,format:a,inputFormat:b,length:[16,17,18,19],cvcLength:[3],luhn:!0},{type:"jcb",pattern:/^35/,format:a,inputFormat:b,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",pattern:/^62/,format:a,inputFormat:b,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"discover",pattern:/^(6011|65|64[4-9]|622)/,format:a,inputFormat:b,length:[16],cvcLength:[3],luhn:!0},{type:"mastercard",pattern:/^5[1-5]/,format:a,inputFormat:b,length:[16],cvcLength:[3],luhn:!0},{type:"amex",pattern:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,inputFormat:/^(\d{4}|\d{4}\s\d{6})$/,length:[15],cvcLength:[3,4],luhn:!0},{type:"visa",pattern:/^4/,format:a,inputFormat:b,length:[13,14,15,16],cvcLength:[3],luhn:!0}],d=function(a){var b,d,e;for(a=(a+"").replace(/\D/g,""),d=0,e=c.length;e>d;d++)if(b=c[d],b.pattern.test(a))return b},e=function(a){var b,d,e;for(d=0,e=c.length;e>d;d++)if(b=c[d],b.type===a)return b};return{fromNumber:function(a){return d(a)},fromType:function(a){return e(a)},defaultFormat:function(){return a},defaultInputFormat:function(){return b}}}]),angular.module("angularPayments").factory("_Format",["Cards","Common","$filter",function(a,b,c){var d={},e=function(a){var b;return null!=a.prop("selectionStart")&&a.prop("selectionStart")!==a.prop("selectionEnd")?!0:("undefined"!=typeof document&&null!==document?null!=(b=document.selection)?"function"==typeof b.createRange?b.createRange().text:void 0:void 0:void 0)?!0:!1},f=function(b){var c,d,e,f,g,h,i;if(e=String.fromCharCode(b.which),c=angular.element(b.currentTarget),i=c.val(),d=a.fromNumber(i+e),f=(i.replace(/\D/g,"")+e).length,h=16,d&&(h=d.length[d.length.length-1]),!(f>=h)){if(!/^\d+$/.test(e)&&!b.meta&&b.keyCode>=46)return b.preventDefault(),void 0;if(null==c.prop("selectionStart")||c.prop("selectionStart")===i.length)return g=a.defaultInputFormat(),d&&(g=d.inputFormat),g.test(i)?(b.preventDefault(),c.val(i+" "+e)):g.test(i+e)?(b.preventDefault(),c.val(i+e+" ")):void 0}},g=function(b){var c,d,f,g;c=angular.element(b.currentTarget),f=String.fromCharCode(b.which),/^\d+$/.test(f)&&(e(c)||(g=(c.val()+f).replace(/\D/g,""),d=a.fromNumber(g),d?g.length<=d.length[d.length.length-1]||b.preventDefault():g.length<=16||b.preventDefault()))},h=function(a){var b,c;return b=angular.element(a.currentTarget),c=b.val(),a.meta||8!==a.which||null!=b.prop("selectionStart")&&b.prop("selectionStart")!==c.length?void 0:/\d\s$/.test(c)&&!a.meta&&a.keyCode>=46?(a.preventDefault(),b.val(c.replace(/\d\s$/,""))):/\s\d?$/.test(c)?(a.preventDefault(),b.val(c.replace(/\s\d?$/,""))):void 0},i=function(b){var c,d,e,f;return(c=a.fromNumber(b))?(e=c.length[c.length.length-1],b=b.replace(/\D/g,""),b=b.slice(0,+e+1||9e9),c.format.global?null!=(f=b.match(c.format))?f.join(" "):void 0:(d=c.format.exec(b),null!=d&&d.shift(),null!=d?d.join(" "):void 0)):b},j=function(a){return setTimeout(function(){var b,c;return b=angular.element(a.target),c=b.val(),c=i(c),b.val(c)})},k=function(a){return null!=a?a.replace(/\s/g,""):a};d.card=function(a,b){a.bind("keypress",g),a.bind("keypress",f),a.bind("keydown",h),a.bind("paste",j),b.$parsers.push(k),b.$formatters.push(i)},_formatCVC=function(a){return $target=angular.element(a.currentTarget),digit=String.fromCharCode(a.which),!/^\d+$/.test(digit)&&!a.meta&&a.keyCode>=46?(a.preventDefault(),void 0):(val=$target.val()+digit,val.length<=4?void 0:(a.preventDefault(),void 0))},d.cvc=function(a){a.bind("keypress",_formatCVC)},_restrictExpiry=function(a){var b,c,d;return b=angular.element(a.currentTarget),c=String.fromCharCode(a.which),!/^\d+$/.test(c)&&!a.meta&&a.keyCode>=46?(a.preventDefault(),void 0):e(b)?void 0:(d=b.val()+c,d=d.replace(/\D/g,""),d.length>6?(a.preventDefault(),void 0):void 0)},_formatExpiry=function(a){var b,c,d;return c=String.fromCharCode(a.which),!/^\d+$/.test(c)&&!a.meta&&a.keyCode>=46?(a.preventDefault(),void 0):(b=angular.element(a.currentTarget),d=b.val()+c,/^\d$/.test(d)&&"0"!==d&&"1"!==d?(a.preventDefault(),b.val("0"+d+" / ")):/^\d\d$/.test(d)?(a.preventDefault(),b.val(""+d+" / ")):void 0)},_formatForwardExpiry=function(a){var b,c,d;return c=String.fromCharCode(a.which),!/^\d+$/.test(c)&&!a.meta&&a.keyCode>=46?void 0:(b=angular.element(a.currentTarget),d=b.val(),/^\d\d$/.test(d)?b.val(""+d+" / "):void 0)},_formatForwardSlash=function(a){var b,c,d;return c=String.fromCharCode(a.which),"/"===c?(b=angular.element(a.currentTarget),d=b.val(),/^\d$/.test(d)&&"0"!==d?b.val("0"+d+" / "):void 0):void 0},_formatBackExpiry=function(a){var b,c;if(!a.meta&&(b=angular.element(a.currentTarget),c=b.val(),8===a.which&&(null==b.prop("selectionStart")||b.prop("selectionStart")===c.length)))return/\d(\s|\/)+$/.test(c)?(a.preventDefault(),b.val(c.replace(/\d(\s|\/)*$/,""))):/\s\/\s?\d?$/.test(c)?(a.preventDefault(),b.val(c.replace(/\s\/\s?\d?$/,""))):void 0};var l=function(a){if(null!=a){var d=b.parseExpiry(a),e=new Date(d.year,d.month-1);return c("date")(e,"MM/yyyy")}return null},m=function(a){if(null!=a){var d=b.parseExpiry(a),e=new Date(d.year,d.month-1);return c("date")(e,"MM / yyyy")}return null};return d.expiry=function(a,b){a.bind("keypress",_restrictExpiry),a.bind("keypress",_formatExpiry),a.bind("keypress",_formatForwardSlash),a.bind("keypress",_formatForwardExpiry),a.bind("keydown",_formatBackExpiry),b.$parsers.push(l),b.$formatters.push(m)},function(a,b,c){if(!d[a])throw types=Object.keys(d),errstr='Unknown type for formatting: "'+a+'". ',errstr+='Should be one of: "'+types.join('", "')+'"';return d[a](b,c)}}]).directive("paymentsFormat",["$window","_Format",function(a,b){return{restrict:"A",require:"ngModel",link:function(a,c,d,e){b(d.paymentsFormat,c,e)}}}]),angular.module("angularPayments").factory("_Validate",["Cards","Common","$parse",function(a,b,c){var d=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},e=function(a){var b,c,d,e,f,g;for(d=!0,e=0,c=(a+"").split("").reverse(),f=0,g=c.length;g>f;f++)b=c[f],b=parseInt(b,10),(d=!d)&&(b*=2),b>9&&(b-=9),e+=b;return e%10===0},f={};return f.cvc=function(b,e,f,g){var h,i;if(null==b||0==b.length)return!0;if(!/^\d+$/.test(b))return!1;var j;if(g.paymentsTypeModel){var k=c(g.paymentsTypeModel);j=k(f)}return j?(h=b.length,d.call(null!=(i=a.fromType(j))?i.cvcLength:void 0,h)>=0):b.length>=3&&b.length<=4},f.card=function(b,f,g,h){var i,j,k;h.paymentsTypeModel&&(k=c(h.paymentsTypeModel));var l=function(){k&&k.assign(g,null),f.$card=null};return null==b||0==b.length?(l(),!0):(b=(b+"").replace(/\s+|-/g,""),/^\d+$/.test(b)?(i=a.fromNumber(b))?(f.$card=angular.copy(i),k&&k.assign(g,i.type),j=b.length,ret=d.call(i.length,j)>=0&&(i.luhn===!1||e(b)),ret):(l(),!1):(l(),!1))},f.expiry=function(a){if(null==a||0==a.length)return!0;obj=b.parseExpiry(a),month=obj.month,year=obj.year;var c,d,e;return month&&year?/^\d+$/.test(month)?/^\d+$/.test(year)?parseInt(month,10)<=12?(2===year.length&&(e=(new Date).getFullYear(),e=e.toString().slice(0,2),year=e+year),d=new Date(year,month),c=new Date,d.setMonth(d.getMonth()-1),d.setMonth(d.getMonth()+1,1),d>c):!1:!1:!1:!1},function(a,b,c,d,e){if(!f[a])throw types=Object.keys(f),errstr='Unknown type for validation: "'+a+'". ',errstr+='Should be one of: "'+types.join('", "')+'"';return f[a](b,c,d,e)}}]).factory("_ValidateWatch",["_Validate",function(a){var b={};return b.cvc=function(b,c,d,e){e.paymentsTypeModel&&d.$watch(e.paymentsTypeModel,function(f,g){if(f!=g){var h=a(b,c.$modelValue,c,d,e);c.$setValidity(b,h)}})},function(a,c,d,e){return b[a]?b[a](a,c,d,e):void 0}}]).directive("paymentsValidate",["$window","_Validate","_ValidateWatch",function(a,b,c){return{restrict:"A",require:"ngModel",link:function(a,d,e,f){var g=e.paymentsValidate;c(g,f,a,e);var h=function(c){var d=b(g,c,f,a,e);return f.$setValidity(g,d),d?c:void 0};f.$formatters.push(h),f.$parsers.push(h)}}}]),angular.module("angularPayments").directive("stripeForm",["$window","$parse","Common",function(a,b,c){return _getDataToSend=function(a){var b=["number","expMonth","expYear","cvc","name","addressLine1","addressLine2","addressCity","addressState","addressZip","addressCountry"],c=function(a){return a.replace(/([A-Z])/g,function(a){return"_"+a.toLowerCase()})},d={};for(i in b)b.hasOwnProperty(i)&&(d[c(b[i])]=angular.copy(a[b[i]]));return d.number=d.number.replace(/ /g,""),d},{restrict:"A",link:function(b,d,e){if(!a.Stripe)throw"stripeForm requires that you have stripe.js installed. Include https://js.stripe.com/v2/ into your html.";var f=angular.element(d);f.bind("submit",function(){expMonthUsed=b.expMonth?!0:!1,expYearUsed=b.expYear?!0:!1,expMonthUsed&&expYearUsed||(exp=c.parseExpiry(b.expiry),b.expMonth=exp.month,b.expYear=exp.year);var d=f.find("button");d.prop("disabled",!0),f.hasClass("ng-valid")?a.Stripe.createToken(_getDataToSend(b),function(){var a=arguments;b.$apply(function(){b[e.stripeForm].apply(b,a)}),d.prop("disabled",!1)}):(b.$apply(function(){b[e.stripeForm].apply(b,[400,{error:"Invalid form submitted."}])}),d.prop("disabled",!1)),b.expiryMonth=expMonthUsed?b.expMonth:null,b.expiryYear=expYearUsed?b.expMonth:null})}}}]);var bespeak=angular.module("bespeak",["ui.bootstrap","bespeak.services","bespeak.progress","bespeak.schedule","bespeak.reservation","bespeak.payment"]);bespeak.config(["$locationProvider",function(a){a.html5Mode(!1)}]),bespeak.config(["$routeProvider",function(a){a.when(window._bspConfig.orderPath,{templateUrl:"templates/book",controller:"ScheduleCtrl"}).when("/reservation/:courseId",{templateUrl:"templates/reservation",controller:"ReservationCtrl"}).when("/payment",{templateUrl:"templates/payment",controller:"PaymentCtrl"}).otherwise({redirect_to:"fukenhel"})}]),bespeak.filter("course",["$filter",function(a){return function(b,c){var d=a("date")(b.startDate,"EEEE M/d/yy @ h:mm a"),e=a("date")(b.startDate,"EEEE M/d/yy @ h:mm a"),f=b.officeName,g=b.courseName,h=c.replace("NAME",g).replace("START",d).replace("OFFICE",f).replace("END",e);return h}}]),angular.module("bespeak.payment",["ui.bootstrap","bespeak.services","angularPayments"]).controller("PaymentCtrl",["$scope","$location","$q","_bspApi","_bspReservation","_bspAlerts",function(a,b,c,d,e,f){a.course=e.course(),a.attendees=e.attendees(),a.email=e.email(),a.form={};var g={creditCardNumber:"",creditCardExp:"",creditCardCCV:""},h=function(a,b){return b=b||g,a=a||{},{creditCardNumber:a.creditCardNumber||b.creditCardNumber,creditCardExp:a.creditCardExp||b.creditCardExp,creditCardCCV:a.creditCardCCV||b.creditCardCCV}};a.submitted=!1,a.valid=function(){return a.payment.$valid},a.navigate=function(c,d){!d||a.valid()?b.path(c):a.submitted=!0},c.all([e.paymentMethod(),e.course(),e.name(),e.phone(),e.paymentDetails()]).then(function(c){var d=c[0],e=c[1],h=c[2],i=c[3],j=c[4];e||(f.addPending({type:"warning",msg:"Please select your course"}),b.path(window._bspConfig.orderPath)),d&&(a.form.paymentMethod=d),a.form.name=h?h:"",a.form.phone=i?i:"",j&&(a.form.paymentDetails=j,g=j)}),a.$watch("form.paymentMethod",function(a){a&&a!=e.paymentMethod()&&e.paymentMethod(a)}),a.$watch("form.name",function(a){e.name(a)}),a.$watch("form.phone",function(a){e.phone(a)}),a.$watch("form.paymentDetails.creditCardNumber",function(a){e.paymentDetails(h({creditCardNumber:a}))}),a.$watch("form.paymentDetails.creditCardExp",function(a){e.paymentDetails(h({creditCardExp:a}))}),a.$watch("form.paymentDetails.creditCardCCV",function(a){e.paymentDetails(h({creditCardCCV:a}))}),a.book=function(){if(a.submitted=!0,a.valid()){var b=f.add({type:"info",msg:"Now reserving your spot, please wait..."});d.book(e).then(function(a){b.close(),f.add({type:"success",msg:"Reservation successful!"});var c=a.data.confirmation_url;window.location=c},function(){b.close(),f.add({type:"error",msg:"Unable to book course. Please double check your payment details and try again."})})}}}]);var bespeakProgress=angular.module("bespeak.progress",["ui.bootstrap","bespeak.services"]);bespeakProgress.controller("ProgressCtrl",["$scope","$location","_bspReservation",function(a,b,c){var d="/reservation/",e="/payment",f=[window._bspConfig.orderPath,d,e];a.course=c.course(),c.watch("course",function(b){a.course=b}),a.isActive=function(a){var c=b.path().substr(0,d.length).toUpperCase()==d.toUpperCase();return b.path()&&b.path()==a||a==d&&c},a.passed=function(a){var c=b.path().substr(0,d.length).toUpperCase()==d.toUpperCase()?1:f.indexOf(b.path());return b.path()&&f.indexOf(a)<c},a.navigate=function(a){b.path(a)}}]),angular.module("bespeak.schedule",["ui.bootstrap","bespeak.services"]).controller("ScheduleCtrl",["$scope","$q","$location","$filter","_bspApi","_bspReservation",function(a,b,c,d,e,f){var g={courseName:decodeURIComponent(c.search()["course-type"]||""),officeName:decodeURIComponent(c.search().office||"")};a.courses=e.courses(),a.filtered_courses=a.course=f.course(),a.form={course_id:null},a.submitted=!1,a.navigate=function(b,d){!d||a.schedule.$valid?c.path(b):a.submitted=!0},e.courses().then(function(b){var c=f.course();c&&c.then(function(f){a.course=f&&e.get_course(f.id)?c:d("filter")(b,g)[0]})}),a.course_filter=g,a.orderProp="start_at",a.$watch("course.id",function(b){b&&b!=a.form.course_id&&(a.form.course_id=b)}),a.$watch("form.course_id",function(b){f.course()&&b==f.course().id||(f.course(e.get_course(b)),a.course=f.course())})}]),angular.module("bespeak.reservation",["ui.bootstrap","bespeak.services"]).controller("ReservationCtrl",["$scope","$location","$routeParams","$q","_bspApi","_bspReservation",function(a,b,c,d,e,f){a.course=e.get_course(c.courseId),a.submitted=!1,d.all([f.course(),a.course]).then(function(c){var d=c[0],e=c[1];e?d&&d.id==e.id||f.course(e):d?b.path("/reservation/"+d.id):a.error="This course is no longer available."}),a.form={email:null,attendees:1},a.navigate=function(c,d){"orderPath"==c&&(c=window._bspConfig.orderPath),!d||a.reservation.$valid?b.path(c):a.submitted=!0},d.all([f.attendees(),f.email()]).then(function(b){var c=b[0],d=b[1];c&&(a.form.attendees=c),d&&(a.form.email=d)}),a.$watch("form.email",function(a){a&&a!=f.email()&&f.email(a)}),a.$watch("form.attendees",function(a){a&&a!=f.attendees()&&f.attendees(a)})}]),angular.module("bespeak.services",["bespeak.services.alerts","bespeak.services.api","bespeak.services.reservation"]),angular.module("bespeak.services.alerts",["ui.bootstrap"]).factory("_bspAlerts",function(){var a={alerts:[],pending:[]};return a.activatePending=function(){return a.alerts=a.alerts.concat(a.pending),a.pending=[],a.alerts},a.add=function(b,c){"object"==typeof b&&(c=b.msg,b=b.type);var d={type:b,msg:c,close:function(){a.closeAlert(this)}};return a.alerts.push(d),d},a.addPending=function(b,c){"object"==typeof b&&(c=b.msg,b=b.type);var d={type:b,msg:c,close:function(){a.closeAlert(this)}};return a.pending.push(d),d},a.clear=function(){a.alerts=[]},a.closeAlert=function(b){var c=a.alerts.indexOf(b);c>=0&&a.alerts.splice(c,1)},a}).controller("AlertCtrl",["$scope","_bspAlerts",function(a,b){a.alertservice=b,a.$on("$routeChangeSuccess",function(){a.alertservice.clear(),a.alertservice.activatePending()})}]),angular.module("bespeak.services.api",[]).factory("_bspApi",["$http","$cacheFactory","$q","_bspAlerts",function(a,b,c,d){var e=function(a,b){var e=function(a,b){for(var c=0,d=a.length;d>c;c++)if(+a[c].id==+b)return a[c];return null},f=window._bspConfig.server,g=window._bspConfig.account,h=(b("_bspCache"),{courses:c.defer(),offices:c.defer(),course_types:c.defer()}),i=a.jsonp(f+"sites/"+g+"/courses/available.jsonp?callback=JSON_CALLBACK",{cache:!0});i.success(function(a){var b=function(a,b,c){function d(a,b){var c=60*(new Date).getTimezoneOffset();return new Date(1e3*a+1e3*(b+c))}var f=e(b,a.course_type_id),g=e(c,a.office_id);return a.courseName=f.name,a.cost=f.cost,a.officeName=g.name,a.officeTimeZoneOffset=g.timeZoneOffset,a.startDate=d(a.start_at,a.officeTimeZoneOffset),a.endDate=d(a.end_at,a.officeTimeZoneOffset),a},c=[];angular.forEach(a.courses,function(d){c.push(b(d,a.course_types,a.offices))}),h.courses.resolve(c),h.offices.resolve(a.offices),h.course_types.resolve(a.course_types)}).error(function(a,b){d.add({type:"error",msg:"Error code "+b+": when loading course data. Please try again."}),h.courses.reject(),h.offices.reject(),h.course_types.reject()}),this.courses=function(){return h.courses.promise},this.get_course=function(a){return this.courses().then(function(b){return e(b,a)})},this.offices=function(){return h.offices.promise},this.get_office=function(a){return this.offices().then(function(b){return e(b,a)})},this.course_types=function(){return h.course_types.promise},this.get_course_type=function(a){return this.course_types().then(function(b){return e(b,a)})},this.book=function(b){function c(a){var b={};switch(a.paymentMethod){case"cash":break;case"credit_card":b.credit_card_number=a.paymentDetails.creditCardNumber,b.credit_card_expiration_month=a.paymentDetails.creditCardExp.split("/")[0],b.credit_card_expiration_year=a.paymentDetails.creditCardExp.split("/")[1],b.credit_card_ccv=a.paymentDetails.creditCardCCV}return b}return b.resolve().then(function(b){var d={email:b.email,attendees:b.attendees,course_id:b.course.id,name:b.name,phone:b.phone,payment_method:"coupon"==b.paymentMethod?"cash":b.paymentMethod,coupon:b.coupon};d.payment_details=c(b);var e=a.post(f+"bookings.json",d);return e})}};return new e(a,b)}]),angular.module("bespeak.services.reservation",[]).service("_bspReservation",["$q",function(a){var b={course:null,attendees:1,email:null,phone:null,name:null,coupon:null,paymentMethod:"cash",paymentDetails:{}},c={all:[],course:[],attendees:[],email:[],phone:[],name:[],coupon:[],paymentMethod:[],paymentDetails:[]},d=function(a,b,d){angular.forEach(c[a].concat(c.all),function(a){a(b,d)})},e={course:function(c){if("undefined"!=typeof c){var e=b.course;b.course=a.when(c),d("course",b.course,e)}return b.course},attendees:function(c){if("undefined"!=typeof c){var e=b.attendees;b.attendees=a.when(c),d("attendees",b.attendees,e)}return b.attendees},email:function(c){if("undefined"!=typeof c){var e=b.email;b.email=a.when(c),d("email",b.email,e)}return b.email},name:function(c){if("undefined"!=typeof c){var e=b.name;b.name=a.when(c),d("name",b.name,e)}return b.name},phone:function(c){if("undefined"!=typeof c){var e=b.phone;b.phone=a.when(c),d("phone",b.phone,e)}return b.phone},coupon:function(c){if("undefined"!=typeof c){var e=b.coupon;b.coupon=a.when(c),d("coupon",b.coupon,e)}return b.coupon},paymentMethod:function(c){if("undefined"!=typeof c){var e=b.paymentMethod;b.paymentMethod=a.when(c),d("paymentMethod",b.paymentMethod,e)}return b.paymentMethod},paymentDetails:function(c){if("undefined"!=typeof c){var e=b.paymentDetails;b.paymentDetails=a.when(c),d("paymentDetails",b.paymentDetails,e)}return b.paymentDetails},watch:function(a,b){return c[a].push(b),this},resolve:function(){var b={};return a.all([this.course(),this.attendees(),this.email(),this.name(),this.phone(),this.coupon(),this.paymentMethod(),this.paymentDetails()]).then(function(a){return b={course:a[0],attendees:a[1],email:a[2],name:a[3],phone:a[4],coupon:a[5],paymentMethod:a[6],paymentDetails:a[7]}})}};return e}]),angular.module("bespeak").run(["$templateCache",function(a){"use strict";a.put("templates/book",'<form id=_bsp-book name=schedule ng-submit="navigate(\'/reservation/\'+form.course.id, true)" novalidate><fieldset><legend>Schedule Your Course</legend><select class=input-xxlarge data-ng-model=form.course_id data-ng-options="course.id as course|course:\'NAME: START &mdash; OFFICE\' for course in courses | filter:course_filter | orderBy:start_at" required></select></fieldset><fieldset><button type=submit class="btn btn-primary">Next</button></fieldset></form>'),a.put("templates/payment",'<form id=_bsp-payment name=payment ng-submit=book() novalidate><fieldset class=reservation-details><legend>Your Reservation Details</legend><div class=course-details><span class=name>{{course.courseName}}</span><span class=office>{{course.officeName}}</span><span class=date-info>{{course.startDate | date:"EEEE M/d/yy \'from\' h:mm a" }} to {{course.endDate | date:\'h:mm a\'}}</span><span class=attendees>{{attendees}}</span><span class=email>{{email}}</span><div class=price><span class=attendees>{{attendees}}</span><span class=multiply>&times;</span><span class=cost>{{course.cost | currency:"$"}}</span><span class=equals>=</span><span class=total>{{course.cost * attendees | currency:"$"}}</span></div></div></fieldset><fieldset class=payment-options><legend>How Would You Like to Pay?</legend><p>You can pay now with a credit card or pay later with cash.</p><label class="radio inline"><input type=radio value=cash ng-model=form.paymentMethod>Cash - pay later</label><label class="radio inline"><input type=radio value=credit_card ng-model=form.paymentMethod>Credit&nbsp;Card - pay now</label><label class="radio inline"><input type=radio value=coupon ng-model=form.paymentMethod>Coupon - pay now</label></fieldset><div id=payment-details ng-switch="" on=form.paymentMethod><section id=pay-cash ng-switch-when=cash><fieldset class=payment-options><h4>Pay by Cash</h4><p class=text-warning>Please be prepared to pay course fees by cash or check when arriving to class.</p><div class=payment-details><div class=due><div class=due-now for=due-now>Total Due Now</div><div class=total id=cash-due-now name=due-now>{{0 | currency:"$"}}</div></div></div><div class=personal-details><div class="control-group name" ng-class="{\'error\': !payment.name.$valid && submitted}"><label for=cash-name>Name</label><input id=cash-name name=name ng-model=name placeholder="Your Name" type=text required><span class=help-inline ng-hide="payment.name.$valid || !submitted">Please enter your name.</span></div><div class="control-group phone" ng-class="{\'error\': !payment.phone.$valid && submitted}"><label for=cash-telephone>Telephone</label><input id=cash-telephone name=phone ng-model=telephone placeholder="(617) 555 - 1212" type=tel required><span class=help-inline ng-hide="payment.phone.$valid || !submitted">Please enter a valid phone number.</span></div></div></fieldset></section><section id=pay-credit_card ng-switch-when=credit_card><fieldset class=payment-options><h4>Pay by Credit Card</h4><div class=payment-details><div class=due><div class=due-now>Total Due Now</div><div class=total id=credit-card-due-now name=due-now>{{course.cost * attendees | currency:"$"}}</div></div></div><div id=credit-card-details class="control-group name" ng-class="{\'error\': !payment.name.$valid && submitted}"><label for=credit-card-name>Name (as it appears on card)</label><input class=input-xlarge id=credit-card-name ng-model=form.name placeholder="Your Name" type=text required name=name><span class=help-inline ng-hide="payment.name.$valid || !submitted">Please enter the name on the credit card.</span></div><div class=control-group ng-class="{\'error\': !payment.creditCardNumber.$valid && submitted}"><label for=credit-card-number>Card Number</label><input autocomplete=off class=input-xlarge id=credit-card-number ng-model=form.paymentDetails.creditCardNumber size=20 type=text payments-format=card payments-validate=card required name=creditCardNumber payments-type-model=type ng-class=form.paymentDetails.type><span class=help-inline ng-hide="payment.creditCardNumber.$valid || !submitted">Please enter a valid credit card number.</span><div class=acceptedCards><img alt=Visa class=fsCreditCardLogo src=//dts8zy8jzywwi.cloudfront.net/37/assets/visa.png><img alt=MasterCard class=fsCreditCardLogo src=//dts8zy8jzywwi.cloudfront.net/37/assets/mastercard.png><img alt="American Express" class=fsCreditCardLogo src=//dts8zy8jzywwi.cloudfront.net/37/assets/amex.png><img alt=Discover class=fsCreditCardLogo src=//dts8zy8jzywwi.cloudfront.net/37/assets/discover.png></div></div><div class="control-group creditCardExp" ng-class="{\'error\': !payment.creditCardExp.$valid && submitted}"><label class=required for=credit-card-exp-month>Expiration Date</label><input class=input-small name=creditCardExp id=credit-card-exp placeholder=MM/YY ng-model=form.paymentDetails.creditCardExp type=text payments-format=expiry payments-validate=expiry><span class=help-inline ng-hide="payment.creditCardExp.$valid || !submitted">Please enter a valid expiration date.</span></div><div class="control-group creditCardCCV" ng-class="{\'error\': !payment.creditCardCCV.$valid && submitted}"><label class=required for=credit-card-ccv>Security Code</label><input class=input-small id=credit-card-ccv maxlength=4 ng-model=form.paymentDetails.creditCardCCV type=tel required payments-format=cvc payments-type-model=type payments-validate=cvc name=creditCardCCV><span class=help-inline ng-hide="payment.creditCardCCV.$valid || !submitted">Please enter a valid security code (found on the back of your credit card).</span></div></fieldset></section><section id=pay-coupon ng-switch-when=coupon><fieldset class=payment-options><h4>Pay by Coupon</h4><div class=payment-details><div class=due><div class=due-now for=due-now>Total Due Now</div><div class=total id=cash-due-now name=due-now>{{0 | currency:"$"}}</div></div></div><div class=personal-details><div class="control-group name"><label class=required for=coupon-name>Name</label><input id=coupon-name ng-model=name placeholder="Your Name" type=text required></div><div class="control-group phone"><label class=required for=coupon-telephone>Telephone</label><input id=coupon-telephone ng-model=phone placeholder="(617) 555 - 1212" type=tel required></div><div class=control-group><label class=required for=coupon-code>Coupon Code</label><input id=coupon-code ng-model=coupon placeholder="Coupon Code" type=text required></div></div></fieldset></section></div><fieldset><button ng-click="navigate(\'/reservation/\'+course.id)" class="btn btn-info">Previous</button><button class="btn btn-primary" type=submit>Complete Your Registration</button></fieldset></form>'),a.put("templates/reservation",'<form id=_bsp-reservation name=reservation ng-submit="navigate(\'/payment\', true)" novalidate><fieldset class=reservation-details><legend>Your Reservation Details</legend><div class=course-details><span class=name>{{course.courseName}}</span><span class=office>{{course.officeName}}</span><span class=date-info>{{course.startDate | date:"EEEE M/d/yy \'from\' h:mm a" }} to {{course.endDate | date:\'h:mm a\'}}</span></div><div class=control-group ng-class="{\'error\': !reservation.email.$valid && submitted}"><label class=control-label for=inputEmail>Email</label><div class=controls><input type=email name=email id=inputEmail placeholder=Email ng-model=form.email required><span class=help-inline ng-hide="reservation.email.$valid || !submitted">Please enter a valid email address.</span></div></div><div class="booking-details control-group" ng-class="{\'error\': !reservation.attendees.$valid && submitted}"><label class=control-label for=attendees>How many people?</label><input name=attendees type=number id=attendees class=attendee-selector ng-model=form.attendees value={{form.attendees}} min=1 max=10 size=2 required><span class=help-inline ng-hide="reservation.attendees.$valid || !submitted">Please specify the number of attendees.</span><div class=price><span class=attendees>{{form.attendees}}</span><span class=multiply>&times;</span><span class=cost>{{course.cost | currency:"$"}}</span><span class=equals>=</span><span class=total>{{course.cost * form.attendees | currency:"$"}}</span></div></div></fieldset><fieldset><button ng-click="navigate(\'orderPath\', false)" class="btn btn-info">Previous</button><button type=submit class="btn btn-primary">Next</button></fieldset></form>')
}]);